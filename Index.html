<!DOCTYPE html>
<html>
<head>
  <title>OnboardX</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js@1.12.0/src/toastify.min.css">
  <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.3.2/css/dataTables.dataTables.css">
  <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/2.3.2/js/dataTables.js"></script>
  <style>
  html, body {
    height: 100%;
    margin: 0;
    padding: 0;
    font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #333;
    overflow: hidden;
    font-weight: bold;
  }
  #app-title {
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif; /* Maintain original font */
  font-size: 1.5em; /* Default h2 size */
  color: white;
  position: relative;
  display: inline-block;
  overflow: hidden;
  white-space: nowrap;
  animation: signatureWrite 4s steps(8, end) infinite;
}
@keyframes signatureWrite {
  0% {
    clip-path: inset(0 100% 0 0);
    opacity: 0;
  }
  10% {
    opacity: 1;
  }
  50% {
    clip-path: inset(0 0 0 0);
    opacity: 1;
  }
  100% {
    clip-path: inset(0 0 0 0);
    opacity: 1;
  }
}
  #app-container {
    height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 0;
    box-sizing: border-box;
  }
  #login-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  z-index: 9999;
  display: none;
  justify-content: center;
  align-items: center;
  opacity: 0;
  transition: opacity 0.6s ease-in-out, transform 0.6s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  transform: scale(0.95);
}
#login-overlay.show {
  display: flex;
  opacity: 1;
  transform: scale(1);
}
#Container {
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
}
#rays {
  z-index: 2;
  position: relative;
  bottom: -1.5em;
  animation: raysPulse 3s ease-in-out infinite;
}
.form {
  position: relative;
  padding: 6%;
  z-index: 3;
  display: flex;
  flex-direction: column;
  border-radius: 1.5rem;
  border: 4px solid rgb(255, 255, 255, 0.2);
  background: linear-gradient(135deg, rgb(30, 60, 114, 0.9), rgb(42, 82, 152, 0.9));
  box-shadow: 0 10px 30px rgb(0, 144, 255, 0.3), inset 0 0 20px rgb(130, 225, 255, 0.5);
  gap: 1.8em;
  min-width: 380px;
  max-width: 480px;
  animation: modernFloat 4.5s ease-in-out infinite;
  will-change: transform;
}
#login-lable {
  text-align: center;
  color: #ffffff;
  font-size: 2.7rem;
  font-weight: 700;
  letter-spacing: 12px;
  text-shadow: 0 0 25px rgb(255, 255, 255, 0.7);
}
#login-title {
  text-align: center;
  color: #ffffff;
  font-size: 2.2rem;
  font-weight: 600;
  letter-spacing: 10px;
  text-shadow: 0 0 20px rgb(255, 255, 255, 0.6);
}
.form-content {
  height: 3.8em;
  padding: 12px 15px;
  color: #1e3c72;
  font-weight: 600;
  letter-spacing: 1.2px;
  border-radius: 12px;
  border: 2px solid rgb(255, 255, 255, 0.3);
  background: rgb(255, 255, 255, 0.95);
  box-shadow: inset 0 4px 8px rgb(0, 0, 0, 0.1);
  transition: all 0.4s ease-in-out;
  width: 100%;
}
.form-content:focus-visible {
  outline: none;
  border-color: #1e90ff;
  box-shadow: 0 0 12px rgb(30, 144, 255, 0.5), inset 0 4px 8px rgb(0, 0, 0, 0.1);
  transform: scale(1.03);
}
.form-content:hover {
  border-color: #1e90ff;
  box-shadow: 0 0 10px rgb(30, 144, 255, 0.4), inset 0 4px 8px rgb(0, 0, 0, 0.1);
  transform: scale(1.03);
}
.form-content::placeholder {
  font-weight: 400;
  color: #666666;
  letter-spacing: 1.2px;
}
.form button {
  cursor: pointer;
  height: 4.2rem;
  padding: 0;
  color: #ffffff;
  font-size: 1.8em;
  letter-spacing: 0.5rem;
  border: 2px solid rgb(255, 255, 255, 0.4);
  background: linear-gradient(144deg, #9c11ff, #2000ee 50%, #15fff3);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  transition: all 0.4s ease-in-out;
  width: 100%;
  box-shadow: 0 6px 20px rgb(0, 144, 255, 0.3);
}
.form button:hover {
  transform: translateY(-6px) scale(1.06);
  box-shadow: 0 8px 25px rgb(0, 144, 255, 0.5);
  background: linear-gradient(144deg, #b32aff, #3a00ff 50%, #00e6ff);
}
@keyframes modernFloat {
  0% { transform: translateY(0) rotate(0deg); }
  25% { transform: translateY(18px) rotate(0.6deg); }
  50% { transform: translateY(0) rotate(-0.6deg); }
  75% { transform: translateY(-18px) rotate(0.6deg); }
  100% { transform: translateY(0) rotate(0deg); }
}
@keyframes raysPulse {
  0% { opacity: 0.5; transform: scale(0.95); }
  50% { opacity: 1; transform: scale(1.15); }
  100% { opacity: 0.5; transform: scale(0.95); }
}
.form button#login-btn {
  cursor: pointer;
  height: 3.8rem;
  padding: 0 1.8rem;
  color: #ffffff;
  font-size: 1.6em;
  font-weight: 600;
  letter-spacing: 0.3rem;
  border: none;
  border-radius: 14px;
  background: linear-gradient(144deg, #9c11ff, #2000ee 50%, #15fff3);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  width: 100%;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 5px 18px rgb(30, 0, 255, 0.4);
}
.form button#login-btn:hover {
  transform: translateY(-4px) scale(1.04);
  box-shadow: 0 7px 25px rgb(30, 0, 255, 0.6);
  background: linear-gradient(144deg, #ad1cff, #3c00ff 50%, #1efff9);
}
.form button#login-btn:active {
  transform: translateY(0) scale(0.98);
  box-shadow: 0 3px 12px rgb(30, 0, 255, 0.3);
}
.form button#login-btn.logging-in {
  pointer-events: none;
  background: linear-gradient(144deg, #cccccc, #b0b0b0 50%, #d3d3d3);
  color: #666666;
  box-shadow: none;
}
.form button#login-btn.logging-in .spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgb(255, 255, 255, 0.3);
  border-top: 3px solid #ffffff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
.form button#login-btn.logging-in .login-text {
  opacity: 0.8;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
  #login-error {
    color: #dc3545;
    margin-top: 15px;
    min-height: 20px;
    opacity: 0;
    transform: translateY(-10px);
    transition: all 0.4s ease;
    font-size: 14px;
    font-weight: bold;
    text-align: center;
  }
  #login-error.show {
    opacity: 1;
    transform: translateY(0);
  }
  @keyframes float {
    0% {
      position: relative;
    }
    50% {
      top: 50px;
    }
    100% {
      position: relative;
    }
  }
  @keyframes rays {
    0% {
      opacity: 0.6;
    }
    50% {
      opacity: 1;
    }
    100% {
      opacity: 0.6;
    }
  }
  #logout-btn {
    position: fixed;
    top: 20px;
    right: 20px;
    background: linear-gradient(135deg, #ff4b2b, #ff416c);
    color: white;
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    box-shadow: 0 4px 15px rgb(0, 0, 0, 0.3);
    opacity: 0;
    transform: translateY(-20px);
    animation: slideIn 0.6s ease-out 0.5s forwards;
    z-index: 110;
  }
  #logout-btn:hover {
    transform: translateY(-2px) scale(1.05);
    box-shadow: 0 6px 20px rgb(0, 0, 0, 0.4);
    background: linear-gradient(135deg, #e53935, #e35d6a);
  }
  #logout-btn:active {
    transform: translateY(0) scale(1);
    box-shadow: 0 2px 10px rgb(0, 0, 0, 0.2);
  }
  @keyframes slideIn {
    to { opacity: 1; transform: translateY(0); }
  }
  #dashboard-container {
    height: 100vh;
    width: 100vw;
    display: flex;
    flex-direction: column;
    padding: 0;
    box-sizing: border-box;
    overflow: auto;
    background: rgb(255, 255, 255, 0.95);
    position: relative;
    opacity: 0;
    transform: translateY(30px);
    transition: all 0.8s cubic-bezier(0.4, 0, 0.2, 1);
  }
  #dashboard-container > *:not(#header) {
    padding: 20px;
  }
  #header {
    position: sticky;
    top: 0;
    left: 0;
    width: 100%;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: white;
    padding: 10px 30px;
    z-index: 100;
    box-shadow: 0 2px 10px rgb(0, 0, 0, 0.2);
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #dashboard-container.visible {
    opacity: 1;
    transform: translateY(0);
  }
  #dashboard-container.hiding {
    opacity: 0;
    transform: translateY(30px) scale(0.98);
  }
  #dashboard-loading-overlay {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgb(255, 255, 255, 0.8);
    display: none;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    opacity: 0;
    transition: opacity 0.6s cubic-bezier(0.4, 0, 0.2, 1);
  }
  #dashboard-loading-overlay.show {
    display: flex;
    opacity: 1;
  }
  #controls {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    background: rgb(255, 255, 255, 0.98);
    padding: 15px 20px;
    border-radius: 12px;
    box-shadow: 0 4px 15px rgb(0, 0, 0, 0.1);
    z-index: 20;
    gap: 15px;
    animation: slideIn 0.6s ease-out;
  }
  #controls-left {
    display: flex;
    align-items: center;
    gap: 15px;
    flex: 1;
  }
  #lastUpdateCall {
    padding: 10px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    font-size: 14px;
    transition: all 0.4s ease;
    background: #f8f9fa;
    width: auto;
    max-width: 200px;
    font-weight: bold;
  }
  #lastUpdateCall:focus {
    border-color: #1e90ff;
    box-shadow: 0 0 10px rgb(30, 144, 255, 0.2);
    transform: scale(1.01);
    outline: none;
  }
  #refreshBtn {
    background: linear-gradient(135deg, #1e90ff, #1e3c72);
    color: white;
    padding: 10px 24px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.4s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    box-shadow: 0 3px 10px rgb(0, 0, 0, 0.15);
    position: relative;
    overflow: hidden;
  }
  #refreshBtn:hover {
    background: linear-gradient(135deg, #1565c0, #0d2b5a);
    transform: translateY(-2px) scale(1.03);
    box-shadow: 0 6px 15px rgb(0, 0, 0, 0.2);
  }
  #refreshBtn:active {
    transform: translateY(0) scale(1);
  }
  #refreshBtn.refreshing .spinner {
    display: inline-block;
    animation: spin 1s linear infinite;
  }
  #refreshBtn.refreshing .refresh-text {
    opacity: 0.7;
  }
  #globalSearch {
    padding: 10px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    background: #f8f9fa;
    width: 200px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(10px);
    animation: slideUpFade 0.6s ease-out 0.3s forwards;
    font-weight: bold;
  }
  #globalSearch:focus {
    border-color: #1e90ff;
    box-shadow: 0 0 10px rgb(30, 144, 255, 0.2);
    transform: scale(1.01);
    width: 220px;
    outline: none;
  }
  #globalSearch::placeholder {
    color: #999;
    font-style: italic;
    font-weight: bold;
  }
  .filter-select {
    padding: 10px 15px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    background: #f8f9fa;
    width: auto;
    min-width: 150px;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    opacity: 0;
    transform: translateY(10px);
    animation: slideUpFade 0.6s ease-out 0.3s forwards;
    font-weight: bold;
  }
  .filter-select:focus {
    border-color: #1e90ff;
    box-shadow: 0 0 10px rgb(30, 144, 255, 0.2);
    transform: scale(1.01);
    outline: none;
  }
  .spinner {
    width: 18px;
    height: 18px;
    border: 3px solid rgb(255, 255, 255, 0.3);
    border-top: 3px solid white;
    border-radius: 50%;
    display: none;
  }
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
  .dataTables_wrapper {
    flex: 1;
    overflow: hidden;
    background: rgb(255, 255, 255, 0.98);
    border-radius: 12px;
    box-shadow: 0 4px 15px rgb(0, 0, 0, 0.1);
    position: relative;
    z-index: 10;
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  table.dataTable {
    width: 100% !important;
    height: 100%;
    table-layout: auto;
    border-collapse: collapse;
    flex-grow: 1;
    margin: 0;
  }
  th {
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: white;
    text-align: center;
    padding: 14px !important;
    font-weight: bold;
    position: sticky;
    top: 0;
    z-index: 10;
    border-bottom: 2px solid #ddd;
    font-size: 14px;
  }
  td {
    padding: 12px !important;
    border-bottom: 1px solid #e0e0e0;
    transition: background 0.4s ease;
    font-size: 14px;
    text-align: center;
    font-weight: bold;
    border-left: 1px solid #e0e0e0;
    border-right: 1px solid #e0e0e0;
  }
  tr:nth-child(even) {
    background: #f9fafb;
  }
  tr:hover {
    background: #e3f2fd;
    transition: background 0.4s ease;
  }
  .new-row {
    animation: slideUpFade 0.8s cubic-bezier(0.4, 0, 0.2, 1) forwards;
  }
  @keyframes slideUpFade {
    0% { opacity: 0; transform: translateY(20px); }
    100% { opacity: 1; transform: translateY(0); }
  }
  #dataTable tbody tr {
    transition: all 0.4s ease;
  }
  .dataTables_scroll {
    display: flex;
    flex-direction: column;
    height: 100%;
  }
  .dataTables_scrollHead {
    flex-shrink: 0;
    z-index: 11;
  }
  .dataTables_scrollBody {
    flex: 1;
    overflow: auto;
    -webkit-overflow-scrolling: touch;
    padding-bottom: 15px;
  }
  .dataTables_scrollBody::-webkit-scrollbar {
    width: 10px;
    height: 10px;
  }
  .dataTables_scrollBody::-webkit-scrollbar-thumb {
    background: #1e90ff;
    border-radius: 5px;
  }
  .dataTables_scrollBody::-webkit-scrollbar-track {
    background: #f1f1f1;
  }
  .dataTables_wrapper_footer {
    position: sticky;
    bottom: 0;
    background: rgb(255, 255, 255, 0.98);
    z-index: 10;
    padding: 12px 15px;
    border-top: 1px solid #e0e0e0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
    box-shadow: 0 -2px 10px rgb(0, 0, 0, 0.05);
  }
  .dataTables_info {
    font-size: 14px;
    color: #444;
    margin-right: auto;
    font-weight: bold;
  }
  .dataTables_paginate {
    margin-left: auto;
    display: inline-flex;
    align-items: center;
  }
  .dataTables_length select {
    padding: 8px;
    border-radius: 8px;
    border: 1px solid #e0e0e0;
    font-size: 14px;
    transition: all 0.4s ease;
    background: #f8f9fa;
    font-weight: bold;
  }
  .dataTables_length select:focus {
    border-color: #1e90ff;
    box-shadow: 0 0 10px rgb(30, 144, 255, 0.2);
    transform: scale(1.01);
    outline: none;
  }
  .loading-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgb(0, 0, 0, 0.5);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
}
.loading-overlay.hidden {
  display: none;
}
.loader {
  width: 112px;
  height: 112px;
  position: relative;
  z-index: 1;
}
.box1,
.box2,
.box3 {
  border: 16px solid #1e3c72;
  box-sizing: border-box;
  position: absolute;
  display: block;
}
.box1 {
  width: 112px;
  height: 48px;
  margin-top: 64px;
  margin-left: 0px;
  animation: abox1 4s 1s forwards ease-in-out infinite;
}
.box2 {
  width: 48px;
  height: 48px;
  margin-top: 0px;
  margin-left: 0px;
  animation: abox2 4s 1s forwards ease-in-out infinite;
}
.box3 {
  width: 48px;
  height: 48px;
  margin-top: 0px;
  margin-left: 64px;
  animation: abox3 4s 1s forwards ease-in-out infinite;
}
@keyframes abox1 {
  0% { width: 112px; height: 48px; margin-top: 64px; margin-left: 0px; }
  12.5% { width: 48px; height: 48px; margin-top: 64px; margin-left: 0px; }
  25% { width: 48px; height: 48px; margin-top: 64px; margin-left: 0px; }
  37.5% { width: 48px; height: 48px; margin-top: 64px; margin-left: 0px; }
  50% { width: 48px; height: 48px; margin-top: 64px; margin-left: 0px; }
  62.5% { width: 48px; height: 48px; margin-top: 64px; margin-left: 0px; }
  75% { width: 48px; height: 112px; margin-top: 0px; margin-left: 0px; }
  87.5% { width: 48px; height: 48px; margin-top: 0px; margin-left: 0px; }
  100% { width: 48px; height: 48px; margin-top: 0px; margin-left: 0px; }
}
@keyframes abox2 {
  0% { width: 48px; height: 48px; margin-top: 0px; margin-left: 0px; }
  12.5% { width: 48px; height: 48px; margin-top: 0px; margin-left: 0px; }
  25% { width: 48px; height: 48px; margin-top: 0px; margin-left: 0px; }
  37.5% { width: 48px; height: 48px; margin-top: 0px; margin-left: 0px; }
  50% { width: 112px; height: 48px; margin-top: 0px; margin-left: 0px; }
  62.5% { width: 48px; height: 48px; margin-top: 0px; margin-left: 64px; }
  75% { width: 48px; height: 48px; margin-top: 0px; margin-left: 64px; }
  87.5% { width: 48px; height: 48px; margin-top: 0px; margin-left: 64px; }
  100% { width: 48px; height: 48px; margin-top: 0px; margin-left: 64px; }
}
@keyframes abox3 {
  0% { width: 48px; height: 48px; margin-top: 0px; margin-left: 64px; }
  12.5% { width: 48px; height: 48px; margin-top: 0px; margin-left: 64px; }
  25% { width: 48px; height: 112px; margin-top: 0px; margin-left: 64px; }
  37.5% { width: 48px; height: 48px; margin-top: 64px; margin-left: 64px; }
  50% { width: 48px; height: 48px; margin-top: 64px; margin-left: 64px; }
  62.5% { width: 48px; height: 48px; margin-top: 64px; margin-left: 64px; }
  75% { width: 48px; height: 48px; margin-top: 64px; margin-left: 64px; }
  87.5% { width: 48px; height: 48px; margin-top: 64px; margin-left: 64px; }
  100% { width: 112px; height: 48px; margin-top: 64px; margin-left: 0px; }
}
.loading-text {
  color: #fff;
  font-size: 1.5rem;
  margin-top: 20px;
  text-align: center;
}
  .modal {
    display: none;
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.7);
    background: white;
    padding: 30px;
    border-radius: 16px;
    box-shadow: 0 15px 40px rgb(0, 0, 0, 0.3);
    z-index: 1000;
    animation: modalPopIn 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    max-width: 400px;
    width: 90%;
    text-align: center;
  }
  .modal.closing {
    animation: modalPopOut 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) forwards;
  }
  @keyframes modalPopIn {
    0% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
  }
  @keyframes modalPopOut {
    0% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(0.7); opacity: 0; }
  }
  .overlay {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgb(0, 0, 0, 0.6);
    z-index: 999;
    opacity: 0;
    transition: opacity 0.5s ease;
  }
  .overlay.show {
    display: block;
    opacity: 1;
  }
  .overlay.hiding {
    opacity: 0;
  }
  .modal button {
    margin: 12px;
    min-width: 120px;
    padding: 10px 20px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.4s ease;
  }
  button {
    background: linear-gradient(135deg, #28a745, #2ecc71);
    color: white;
    border: none;
    padding: 10px 20px;
    border-radius: 8px;
    cursor: pointer;
    font-size: 14px;
    font-weight: bold;
    transition: all 0.4s ease;
    position: relative;
    overflow: hidden;
    box-shadow: 0 3px 10px rgb(0, 0, 0, 0.15);
  }
  button:hover {
    background: linear-gradient(135deg, #218838, #27ae60);
    transform: translateY(-2px) scale(1.03);
    box-shadow: 0 6px 15px rgb(0, 0, 0, 0.2);
  }
  button:active {
    transform: translateY(0) scale(1);
  }
  button::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0;
    height: 0;
    background: rgb(255, 255, 255, 0.3);
    border-radius: 50%;
    transform: translate(-50%, -50%);
    transition: width 0.6s ease, height 0.6s ease;
  }
  button:active::before {
    width: 200px;
    height: 200px;
  }
  button.saving .spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgb(255, 255, 255, 0.3);
  border-top: 3px solid #ffffff;
  border-radius: 50%;
  animation: spin 1s linear infinite;
}
button.saving .saving-text {
  opacity: 0.8;
}
button.saving {
  pointer-events: none;
  background: linear-gradient(144deg, #cccccc, #b0b0b0 50%, #d3d3d3);
  color: #666666;
  box-shadow: none;
  transition: all 0.3s ease;
}
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
  input, select, textarea {
    width: 100%;
    box-sizing: border-box;
    padding: 8px;
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    font-size: 14px;
    transition: all 0.4s ease;
    background: #f8f9fa;
    font-weight: bold;
  }
  input:focus, select:focus, textarea:focus {
    border-color: #1e90ff;
    box-shadow: 0 0 10px rgb(30, 144, 255, 0.2);
    transform: scale(1.01);
    outline: none;
  }
  .dataTables_filter input {
    width: auto;
    margin-left: 10px;
    border-radius: 8px;
    font-weight: bold;
  }
  .now-btn {
  background: linear-gradient(135deg, #1e90ff, #1565c0);
  color: white;
  border: none;
  padding: 8px 16px;
  border-radius: 8px;
  cursor: pointer;
  font-size: 12px;
  font-weight: bold;
  transition: all 0.4s ease;
}
.now-btn:hover {
  background: linear-gradient(135deg, #1565c0, #0d47a1);
  transform: translateY(-2px) scale(1.03);
}
.now-btn:active {
  transform: translateY(0) scale(1);
}
  @media (max-width: 768px) {
    #app-container { padding: 0; }
    #dashboard-container { padding: 10px; border-radius: 0; }
    #controls { flex-direction: column; align-items: stretch; gap: 10px; padding: 12px; }
    #controls-left { flex-direction: column; align-items: stretch; }
    #lastUpdateCall { max-width: 100%; }
    #refreshBtn { width: 100%; }
    #globalSearch { width: 100%; }
    .filter-select { width: 100%; min-width: auto; }
    th, td { padding: 10px !important; font-size: 13px; }
    .modal { width: 95%; padding: 20px; }
    #logout-btn { top: 10px; right: 10px; padding: 10px 20px; font-size: 13px; }
    .form { width: 90%; max-width: 300px; padding: 3%; }
    .form-content { font-size: 14px; height: 2.5em; }
    .form button#login-btn { font-size: 1.2em; height: 3em; }
    #login-title { font-size: 1.5rem; letter-spacing: 6px; }
  }
  tr.has-remarks {
  background: #e0f7fa !important; /* Light cyan background for rows with remarks */
}
/* Position Reporting button near Logout (left of it, blue theme) */
#reporting-btn {
  position: fixed;
  top: 20px;
  right: 140px; /* Adjusted to sit left of logout-btn; tweak if needed based on button widths */
  background: linear-gradient(135deg, #1e90ff, #1565c0);
  color: white;
  padding: 12px 24px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-size: 14px;
  font-weight: bold;
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  box-shadow: 0 4px 15px rgb(0, 0, 0, 0.3);
  opacity: 0;
  transform: translateY(-20px);
  animation: slideIn 0.6s ease-out 0.5s forwards;
  z-index: 110;
}
#reporting-btn:hover {
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 20px rgb(0, 0, 0, 0.4);
  background: linear-gradient(135deg, #1565c0, #0d47a1);
}
#reporting-btn:active {
  transform: translateY(0) scale(1);
  box-shadow: 0 2px 10px rgb(0, 0, 0, 0.2);
}
/* Make report modal full-screen */
/* Full-screen modal with centered content */
#reportModal {
  position: fixed;
  top: 0;
  left: 0;
  width: 100vw;
  height: 100vh;
  max-width: none;
  transform: none;
  background: linear-gradient(135deg, #f8f9fa, #ffffff); /* Subtle white gradient for clean look */
  padding: 40px;
  border-radius: 0;
  box-shadow: none;
  z-index: 1000;
  overflow-y: auto;
  display: flex;
  justify-content: center;
  align-items: flex-start; /* Start from top for better UX */
  animation: fadeInModal 0.5s ease-out;
}
@keyframes fadeInModal {
  from { opacity: 0; }
  to { opacity: 1; }
}
#reportModal.closing {
  animation: fadeOutModal 0.4s ease-in;
}
@keyframes fadeOutModal {
  from { opacity: 1; }
  to { opacity: 0; }
}
/* Container for content (limits width for professionalism) */
.report-container {
  max-width: 1200px; /* Professional width limit */
  width: 100%;
  padding: 20px;
  background: white;
  border-radius: 16px;
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
/* Title styling with animation */
.report-title {
  font-size: 2rem;
  color: #1e3c72;
  margin-bottom: 20px;
  animation: slideDownTitle 0.5s ease-out;
}
@keyframes slideDownTitle {
  from { transform: translateY(-20px); opacity: 0; }
  to { transform: translateY(0); opacity: 1; }
}
/* Date inputs row */
.date-inputs {
  display: flex;
  gap: 20px;
  align-items: center;
  flex-wrap: wrap;
  justify-content: center;
}
.date-inputs label {
  font-weight: bold;
  color: #333;
}
input[type="date"] {
  background: #fff url('https://cdn1.iconfinder.com/data/icons/cc_mono_icon_set/blacks/16x16/calendar_2.png') 97% 50% no-repeat;
  border: 1px solid #c4c4c4;
  border-radius: 8px;
  background-color: #f8f9fa;
  padding: 12px 16px;
  box-shadow: inset 0 3px 6px rgba(0,0,0,0.1);
  width: 200px;
  font-size: 16px;
  font-weight: bold;
  transition: all 0.3s ease;
  cursor: pointer;
}
input[type="date"]:hover,
input[type="date"]:focus {
  border-color: #1e90ff;
  box-shadow: 0 0 12px rgba(30, 144, 255, 0.3);
  transform: scale(1.02);
}
/* Generate button - professional gradient */
.gradient-btn {
  position: relative;
  display: inline-block;
  padding: 12px 24px;
  border-radius: 8px;
  background: linear-gradient(135deg, #1e90ff, #1565c0);
  color: white;
  font-size: 16px;
  font-weight: bold;
  text-decoration: none;
  border: none;
  cursor: pointer;
  overflow: hidden;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.gradient-btn:hover {
  background: linear-gradient(135deg, #1565c0, #0d47a1);
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}
.gradient-btn:active {
  transform: translateY(0) scale(1);
}
/* Close button - green for positive action */
.close-btn {
  padding: 12px 24px;
  background: linear-gradient(135deg, #28a745, #2ecc71);
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}
.close-btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
}
/* Modern table with animations and professional styling */
.modern-table {
  width: 100%;
  border-collapse: separate;
  border-spacing: 0;
  font-family: 'Inter', 'Segoe UI', Arial, sans-serif;
  background: white;
  border-radius: 12px;
  overflow: hidden;
  box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  margin: 20px 0;
}
.modern-table th {
  background: linear-gradient(135deg, #1e3c72, #2a5298);
  color: white;
  padding: 16px;
  text-align: center;
  font-weight: bold;
  font-size: 16px;
  border-bottom: 2px solid #ddd;
}
.modern-table td {
  padding: 16px;
  text-align: center;
  border-bottom: 1px solid #e0e0e0;
  transition: all 0.3s ease;
  font-size: 14px;
  font-weight: bold;
}
.modern-table tr:nth-child(even) {
  background: #f9fafb;
}
.modern-table tr:hover td {
  background: #e3f2fd;
  transform: scale(1.02); /* Subtle cell scale on hover */
}
/* Row fade-in animation */
.modern-table tbody tr {
  animation: fadeInRow 0.5s ease-out forwards;
  opacity: 0;
}
@keyframes fadeInRow {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}
/* Stagger animation for rows */
.modern-table tbody tr:nth-child(1) { animation-delay: 0.1s; }
.modern-table tbody tr:nth-child(2) { animation-delay: 0.2s; }
.modern-table tbody tr:nth-child(3) { animation-delay: 0.3s; }
/* Add more delays for additional rows as needed */
/* Responsive adjustments */
@media (max-width: 768px) {
  .report-container {
    padding: 10px;
  }
  .date-inputs {
    flex-direction: column;
    gap: 10px;
  }
  input[type="date"] {
    width: 100%;
  }
  .modern-table th, .modern-table td {
    padding: 10px;
    font-size: 14px;
  }
}
/* Welcome Message Animation (inspired by uiverse.io gentle-shadow-47) */
/* Update CSS for welcome message position (add/replace in <style>) */
#welcome-message {
  position: fixed;
  top: 20px;
  right: 280px; /* Adjusted to sit left of reporting-btn; tweak based on text length */
  font-size: 1.2em;
  color: #ffffff;
  padding: 5px 15px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.1);
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
  opacity: 0;
  animation: fadeInWelcome 0.8s ease-out forwards;
  z-index: 110;
}
@keyframes fadeInWelcome {
  from { opacity: 0; transform: translateY(-10px); }
  to { opacity: 1; transform: translateY(0); }
}
/* Call Duration Button (inspired by uiverse.io witty-rabbit-59) */
.call-duration-btn {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  background: linear-gradient(135deg, #1e90ff, #1565c0);
  color: white;
  font-size: 12px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
}
.call-duration-btn:hover {
  background: linear-gradient(135deg, #1565c0, #0d47a1);
  transform: translateY(-2px) scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
}
.call-duration-btn:active {
  transform: translateY(0) scale(1);
}
.call-duration-btn.stopped {
  background: linear-gradient(135deg, #28a745, #2ecc71);
}
.call-duration-btn.stopped:hover {
  background: linear-gradient(135deg, #218838, #27ae60);
}
.duration-text {
  display: block;
  margin-top: 5px;
  font-weight: bold;
  color: #333;
}
</style>
</head>
<body>
<div id="app-container">
  <div id="login-overlay" class="overlay">
    <div id="Container">
      <div class="form">
        <div id="login-title">Login</div>
        <input class="form-content" type="text" id="username" placeholder="Username (BRAND-CURRENCY)">
        <input class="form-content" type="password" id="password" placeholder="Password">
        <button id="login-btn"><span class="spinner"></span><span class="login-text">Continue</span></button>
        <div id="login-error"></div>
      </div>
      <div id="rays">
        <svg
          fill="none"
          viewBox="0 0 299 152"
          height="9em"
          width="18em"
          xmlns="http://www.w3.org/2000/svg"
        >
          <path
            fill="url(#paint0_linear_8_3)"
            d="M149.5 152H133.42L9.53674e-07 4.70132e-06H149.5L299 4.70132e-06L165.58 152H149.5Z"
          ></path>
          <defs>
            <linearGradient
              gradientUnits="userSpaceOnUse"
              y2="12.1981"
              x2="150.12"
              y1="152"
              x1="149.5"
              id="paint0_linear_8_3"
            >
              <stop stop-color="#00E0FF"></stop>
              <stop stop-opacity="0" stop-color="#65EDFF" offset="1"></stop>
            </linearGradient>
          </defs>
        </svg>
      </div>
      <div id="emiter">
        <svg
          fill="none"
          viewBox="0 0 160 61"
          height="61"
          width="160"
          xmlns="http://www.w3.org/2000/svg"
        >
          <g filter="url(#filter0_di_1_38)">
            <path
              fill="#2B2B2B"
              d="M80 27.9997C121.974 27.9997 156 22.4032 156 15.4996L156 40.4998C156 47.4034 121.974 52.9998 80 52.9998C38.0265 52.9998 4.00028 47.4034 4 40.4998V40.4998V15.51C4.0342 22.4089 38.0474 27.9997 80 27.9997Z"
              clip-rule="evenodd"
              fill-rule="evenodd"
            ></path>
          </g>
          <ellipse
            fill="url(#paint0_radial_1_38)"
            ry="4.80773"
            rx="28.3956"
            cy="17.4236"
            cx="80"
          ></ellipse>
          <g filter="url(#filter1_i_1_38)">
            <path
              fill="#323232"
              d="M80 28.0002C121.974 28.0002 156 22.4037 156 15.5001C156 8.59648 121.974 3 80 3C38.0264 3 4 8.59648 4 15.5001C4 22.4037 38.0264 28.0002 80 28.0002ZM80.0001 20.308C96.1438 20.308 109.231 18.1555 109.231 15.5002C109.231 12.845 96.1438 10.6925 80.0001 10.6925C63.8564 10.6925 50.7693 12.845 50.7693 15.5002C50.7693 18.1555 63.8564 20.308 80.0001 20.308Z"
              clip-rule="evenodd"
              fill-rule="evenodd"
            ></path>
          </g>
          <g filter="url(#filter2_di_1_38)">
            <path
              fill="#378BA6"
              d="M106.725 17.4505C108.336 16.8543 109.231 16.1943 109.231 15.4999C109.231 12.8446 96.1438 10.6921 80.0001 10.6921C63.8564 10.6921 50.7693 12.8446 50.7693 15.4999C50.7693 16.1943 51.6645 16.8543 53.2752 17.4504C53.275 17.4414 53.2748 17.4323 53.2748 17.4232C53.2748 14.768 65.2401 12.6155 80.0001 12.6155C94.7601 12.6155 106.725 14.768 106.725 17.4232C106.725 17.4323 106.725 17.4414 106.725 17.4505Z"
              clip-rule="evenodd"
              fill-rule="evenodd"
            ></path>
          </g>
          <defs>
            <filter
              color-interpolation-filters="sRGB"
              filterUnits="userSpaceOnUse"
              height="45.5002"
              width="160"
              y="15.4996"
              x="0"
              id="filter0_di_1_38"
            >
              <feFlood result="BackgroundImageFix" flood-opacity="0"></feFlood>
              <feColorMatrix
                result="hardAlpha"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                type="matrix"
                in="SourceAlpha"
              ></feColorMatrix>
              <feOffset dy="4"></feOffset>
              <feComposite operator="out" in2="hardAlpha"></feComposite>
              <feColorMatrix
                values="0 0 0 0 0.620833 0 0 0 0 0.620833 0 0 0 0 0.620833 0 0 0 0.25 0"
                type="matrix"
              ></feColorMatrix>
              <feBlend
                result="effect1_dropShadow_1_38"
                in2="BackgroundImageFix"
                mode="normal"
              ></feBlend>
              <feBlend
                result="shape"
                in2="effect1_dropShadow_1_38"
                in="SourceGraphic"
                mode="normal"
              ></feBlend>
              <feColorMatrix
                result="hardAlpha"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                type="matrix"
                in="SourceAlpha"
              ></feColorMatrix>
              <feOffset></feOffset>
              <feComposite
                k3="1"
                k2="-1"
                operator="arithmetic"
                in2="hardAlpha"
              ></feComposite>
              <feColorMatrix
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0"
                type="matrix"
              ></feColorMatrix>
              <feBlend
                result="effect2_innerShadow_1_38"
                in2="shape"
                mode="normal"
              ></feBlend>
            </filter>
            <filter
              color-interpolation-filters="sRGB"
              filterUnits="userSpaceOnUse"
              height="25.0002"
              width="152"
              y="3"
              x="4"
              id="filter1_i_1_38"
            >
              <feFlood result="BackgroundImageFix" flood-opacity="0"></feFlood>
              <feBlend
                result="shape"
                in2="BackgroundImageFix"
                in="SourceGraphic"
                mode="normal"
              ></feBlend>
              <feColorMatrix
                result="hardAlpha"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                type="matrix"
                in="SourceAlpha"
              ></feColorMatrix>
              <feMorphology
                result="effect1_innerShadow_1_38"
                in="SourceAlpha"
                operator="erode"
                radius="3"
              ></feMorphology>
              <feOffset></feOffset>
              <feComposite
                k3="1"
                k2="-1"
                operator="arithmetic"
                in2="hardAlpha"
              ></feComposite>
              <feColorMatrix
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 0"
                type="matrix"
              ></feColorMatrix>
              <feBlend
                result="effect1_innerShadow_1_38"
                in2="shape"
                mode="normal"
              ></feBlend>
            </filter>
            <filter
              color-interpolation-filters="sRGB"
              filterUnits="userSpaceOnUse"
              height="26.7583"
              width="78.4615"
              y="0.692139"
              x="40.7693"
              id="filter2_di_1_38"
            >
              <feFlood result="BackgroundImageFix" flood-opacity="0"></feFlood>
              <feColorMatrix
                result="hardAlpha"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                type="matrix"
                in="SourceAlpha"
              ></feColorMatrix>
              <feMorphology
                result="effect1_dropShadow_1_38"
                in="SourceAlpha"
                operator="dilate"
                radius="2"
              ></feMorphology>
              <feOffset></feOffset>
              <feComposite operator="out" in2="hardAlpha"></feComposite>
              <feColorMatrix
                values="0 0 0 0 0 0 0 0 0 0.941176 0 0 0 0 1 0 0 0 1 0"
                type="matrix"
              ></feColorMatrix>
              <feBlend
                result="effect1_dropShadow_1_38"
                in2="BackgroundImageFix"
                mode="color-dodge"
              ></feBlend>
              <feBlend
                result="shape"
                in2="effect1_dropShadow_1_38"
                in="SourceGraphic"
                mode="normal"
              ></feBlend>
              <feColorMatrix
                result="hardAlpha"
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
                type="matrix"
                in="SourceAlpha"
              ></feColorMatrix>
              <feMorphology
                result="effect2_innerShadow_1_38"
                in="SourceAlpha"
                operator="erode"
                radius="1"
              ></feMorphology>
              <feOffset></feOffset>
              <feComposite
                k3="1"
                k2="-1"
                operator="arithmetic"
                in2="hardAlpha"
              ></feComposite>
              <feColorMatrix
                values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.52 0"
                type="matrix"
              ></feColorMatrix>
              <feBlend
                result="effect2_innerShadow_1_38"
                in2="shape"
                mode="normal"
              ></feBlend>
            </filter>
            <radialGradient
              gradientTransform="translate(80 17.4236) rotate(90) scale(6.25004 36.9143)"
              gradientUnits="userSpaceOnUse"
              r="1"
              cy="0"
              cx="0"
              id="paint0_radial_1_38"
            >
              <stop stop-color="#00FFF0"></stop>
              <stop stop-color="#001AFF" offset="0.901042"></stop>
            </radialGradient>
          </defs>
        </svg>
      </div>
    </div>
  </div>
  <!-- Insert after the existing <button id="logout-btn">Logout</button> -->
<button id="reporting-btn">Reporting</button>
  <button id="logout-btn">Logout</button>
  <div id="dashboard-container">
    <div id="header">
      <h2 id="app-title">OnboardX</h2>
      <div id="welcome-message" class="welcome-text"></div>
</div>
<div class="loading-overlay" id="initialLoadOverlay">
  <div class="loader">
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
  </div>
  <div class="loading-text"></div>
</div>
<div class="loading-overlay" id="dashboard-loading-overlay">
  <div class="loader">
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
  </div>
  <div class="loading-text"></div>
</div>
<div class="loading-overlay hidden" id="tableLoadOverlay">
  <div class="loader">
    <div class="box1"></div>
    <div class="box2"></div>
    <div class="box3"></div>
  </div>
  <div class="loading-text"></div>
</div>
    <div id="controls">
      <div id="controls-left">
        <label for="lastUpdateCall">Last Update:</label>
        <input type="datetime-local" id="lastUpdateCall" step="1">
        <input type="text" id="globalSearch" placeholder="Search all columns...">
        <select id="channelFilter" class="filter-select">
          <option value="">All Channels</option>
        </select>
        <select id="callStatusFilter" class="filter-select">
          <option value="">All Call Statuses</option>
        </select>
        <select id="feedbackFilter" class="filter-select">
          <option value="">All Feedback</option>
        </select>
        <select id="preferredGameFilter" class="filter-select">
          <option value="">All Preferred Games</option>
        </select>
        <select id="bonusOfferedFilter" class="filter-select">
          <option value="">All Bonus Offered</option>
        </select>
        <select id="socialMediaAddedFilter" class="filter-select">
          <option value="">All Social Media Added</option>
        </select>
        <select id="secondFollowUpFilter" class="filter-select">
          <option value="">All 2nd Follow-Ups</option>
        </select>
        <select id="thirdFollowUpFilter" class="filter-select">
          <option value="">All 3rd Follow-Ups</option>
        </select>
        <select id="agentFilter" class="filter-select">
          <option value="">All Agents</option>
        </select>
        <button id="refreshBtn"><span class="spinner"></span><span class="refresh-text">Refresh</span></button>
      </div>
    </div>
    <table id="dataTable" class="display">
      <thead>
        <tr>
          <th>Called Date</th>
          <th>Account Status</th>
          <th>Deposit Time</th>
          <th>Registration Date</th>
          <th>Username</th>
          <th>Full Name</th>
          <th>Email</th>
          <th>Phone</th>
          <th>Channel</th>
          <th>Call Status</th>
          <th>Feedback</th>
          <th>Agent Remark</th>
          <th>Preferred Game</th>
          <th>Bonus Offered</th>
          <th>Social Media Added</th>
          <th>Call Duration</th>
          <th>2nd Follow-Up</th>
          <th>3rd Follow-Up</th>
          <th>Agent Name</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div id="dataTable_paginate"></div>
  </div>
  <div class="overlay" id="modalOverlay"></div>
  <div class="modal" id="confirmModal">
    <p>Confirm masking this phone number?</p>
    <button onclick="confirmMask()">Yes</button>
    <button onclick="closeModal()">No</button>
  </div>
  <div class="modal" id="reportModal">
  <div class="report-container">
    <h3 class="report-title">Generate Report</h3>
    <div class="date-inputs">
      <label for="startDate">Start Date:</label>
      <input type="date" id="startDate">
      <label for="endDate">End Date:</label>
      <input type="date" id="endDate">
    </div>
    <button id="generateReportBtn" class="gradient-btn"><span class="spinner"></span><span class="saving-text">Generate Report</span></button>
    <table id="reportTable" class="modern-table display">
      <thead><tr><th>Category</th></tr></thead>
      <tbody></tbody>
    </table>
    <button class="close-btn" onclick="closeReportModal()">Close</button>
  </div>
</div>
  <div class="modal" id="logoutConfirmModal">
    <p>Are you sure you want to logout?</p>
    <button onclick="confirmLogout()">Yes</button>
    <button onclick="cancelLogout()">No</button>
  </div>
</div>
<script>
  const helperMap = {
    'DP BDT': '1Z0aOBUxvTVAoTpZ9yDCLoif7Z2qX6OM4x0K8xoWkHDM',
    'SLB BDT': '1wB0T5_QnEyh-d3F9Q1SQITN70WOLMI-sRDbodtPnPB0',
    'SB BDT': '1bO9JgD5Ts_Pa55G5W59Av2otlaggNYt3o73-_lsEl08',
    'JB BDT': '1VR19df9vuwMQLB03PF2soI4L9iIJCDJb7ToBziz4L1o',
    'HB BDT': '1zucEgdDtQz-UFkHtwyUGTOU2q2LxepM3iLZmZU6axsE',
    'KV BDT': '1CCVOl6mKx6FxKC528Tbs1Z9WYWaZVX51z7tkGA_KyVo',
    'BJD BDT': '1woJb13AQ3F1YEeLWEwVVGMRKeVOYJGlD-PmHOCt2bNE',
    'CX PKR': '1WU8lYW4yFQEP0b6vm0KHm4A5FVORHqHrJoP_RUxdlBM',
    'CX INR': '1F4YM3_igTVFXP_Wm4p4jbgp5_OUeaMgV5l20ayKbXEs',
    'JW BDT': '1neg0Ngs_DSQI7GIEPS2kveCMQ1IIqkJX3kxeI4BDyVU',
    'BJ THB': '1zqZZ9r9bFdlj2dXyybLrf6O9yV89jf88Ifs06nVu2F0',
    'BJ PKR': '1XZNajNVYpjsRD7Gvy1nBa0aqWp0J3LxxqBAEFF41xwY',
    'BJ MMK': '1SwFOdrle72J9e5E_O8mhe6OM4nalSLVslZip7-4Dmbk',
    'BJ PHP': '1i0-cOBl8Av5GTp4ijoXYUsZZNbRpLos7QuE18dtLAAE',
    'BN BDT': '1m_FcxY8J0euXI3D58dsRxQhpj6bIeIaiTYsuLu_5rXk',
    'CX BDT': '19eHTqhPAmFCrQUiLZtt55FtQzDlBDsKfD6xEU1m_Kj0',
    'MP BDT': '1_2_cKAs0Kkb96yWo8cXFwiFhMxP796zPrTVQj2N4mc4',
    'MP PKR': '1-27kyfaNC08fgFQPFp9rny6v67jeCfE08tF5K5LOLps',
    'BJ BDT': '152DyWZqJ6dRZ5U40nEBS83bXt4c8zYZQHB9Bw76deH8',
    'JW INR': '1hbAvir_-v2QrK0te263TmU5QcvSxxCIpvzkdnQnRX58'
  };
  let dropdowns = {};
let confirmed = false;
let currentRow = null;
let debounceTimer;
let dataTable;
let drawTimer;
let userSuffix = sessionStorage.getItem('userSuffix') || "";
const loginOverlay = document.getElementById('login-overlay');
const loginContainer = document.getElementById('Container');
const dashboardContainer = document.getElementById('dashboard-container');
const loginBtn = document.getElementById('login-btn');
const loginError = document.getElementById('login-error');
const initialLoadOverlay = document.getElementById('initialLoadOverlay');
const tableLoadOverlay = document.getElementById('tableLoadOverlay');
const dashboardLoadingOverlay = document.getElementById('dashboard-loading-overlay');
const logoutBtn = document.getElementById('logout-btn');
const logoutConfirmModal = document.getElementById('logoutConfirmModal');
const modalOverlay = document.getElementById('modalOverlay');
const refreshBtn = document.getElementById('refreshBtn');
const globalSearch = document.getElementById('globalSearch');
// Update DOMContentLoaded
document.addEventListener('DOMContentLoaded', () => {
  console.log('DOM loaded, userSuffix:', userSuffix);
  if (!userSuffix) {
    loginOverlay.style.display = 'flex';
    loginOverlay.classList.add('show');
    console.log('Login overlay shown');
  } else {
    dashboardContainer.classList.add('visible');
    logoutBtn.style.display = 'block';
    // Set welcome message
    const usernamePrefix = userSuffix.split('-')[0] || 'User';
const welcomeMessage = document.getElementById('welcome-message');
welcomeMessage.textContent = `Welcome, ${usernamePrefix}!`;
welcomeMessage.style.opacity = '0'; // Reset for animation
setTimeout(() => {
  welcomeMessage.style.opacity = '1';
  welcomeMessage.style.transition = 'opacity 0.8s ease-out';
}, 100); // Slight delay for smooth effect
    initializeDashboard();
    console.log('Dashboard initialized');
    showInitialLoad(); // Show initial load overlay on dashboard init
  }
});
function showLoginError(message) {
  loginError.textContent = message;
  loginError.classList.add('show');
}
function hideLoginError() {
  loginError.classList.remove('show');
}
function showInitialLoad() {
  initialLoadOverlay.classList.remove('hidden');
  const loader = initialLoadOverlay.querySelector('.loader');
  if (loader) loader.style.display = 'block';
}
function hideInitialLoad() {
  setTimeout(() => {
    initialLoadOverlay.classList.add('hidden');
  }, 300);
}
function showTableLoad() {
  tableLoadOverlay.classList.remove('hidden');
  const loader = tableLoadOverlay.querySelector('.loader');
  if (loader) loader.style.display = 'block';
}
function hideTableLoad() {
  setTimeout(() => {
    tableLoadOverlay.classList.add('hidden');
  }, 300);
}
function showDashboardLoad() {
  dashboardLoadingOverlay.classList.remove('hidden');
  const loader = dashboardLoadingOverlay.querySelector('.loader');
  if (loader) loader.style.display = 'block';
}
function hideDashboardLoad() {
  setTimeout(() => {
    dashboardLoadingOverlay.classList.add('hidden');
  }, 300);
}
function maskPhone(phone) {
  return phone && phone.length > 4 ? '****' + phone.slice(-4) : phone;
}
// Add this to simulate initial load and hide after a delay
if (!userSuffix) {
  showInitialLoad();
  setTimeout(hideInitialLoad, 2000); // Hide after 2 seconds (adjust as needed)
}
// Rest of your existing JavaScript...
  async function attemptLogin() {
    const usernameInput = document.getElementById('username').value.trim();
    const passwordInput = document.getElementById('password').value;
    hideLoginError();
    loginBtn.classList.add('logging-in');
    try {
      const res = await fetch('https://api.ipify.org?format=json');
      const data = await res.json();
      const ip = data.ip;
      console.log('Fetching IP:', ip);
      google.script.run
        .withSuccessHandler(response => {
          console.log('Login response:', response);
          if (!response.success) {
            showLoginError(response.message);
            loginBtn.classList.remove('logging-in');
            return;
          }
          userSuffix = response.suffix;
          sessionStorage.setItem('userSuffix', userSuffix);
          loginOverlay.classList.remove('show');
          setTimeout(() => {
            loginOverlay.style.display = 'none';
            dashboardContainer.classList.add('visible');
            logoutBtn.style.display = 'block';
            initializeDashboard();
            loginBtn.classList.remove('logging-in');
            console.log('Login successful, dashboard visible');
          }, 600);
        })
        .withFailureHandler(error => {
          console.log('Login failed:', error);
          showLoginError('Login failed: ' + error.message);
          loginBtn.classList.remove('logging-in');
        })
        .login(usernameInput, passwordInput, ip);
    } catch (err) {
      console.log('IP fetch error:', err);
      showLoginError('Failed to retrieve IP address: ' + err.message);
      loginBtn.classList.remove('logging-in');
    }
  }
  loginBtn.addEventListener('click', attemptLogin);
  document.getElementById('password').addEventListener('keypress', function(event) {
    if (event.key === 'Enter') {
      attemptLogin();
    }
  });
  function initiateLogout() {
    modalOverlay.classList.add('show');
    logoutConfirmModal.style.display = 'block';
    setTimeout(() => {
      logoutConfirmModal.classList.remove('closing');
    }, 10);
  }
  function performLogout() {
    sessionStorage.clear();
    dashboardContainer.classList.add('hiding');
    logoutBtn.style.opacity = '0';
    modalOverlay.classList.remove('show');
    modalOverlay.classList.add('hiding');
    logoutConfirmModal.classList.add('closing');
    setTimeout(() => {
      dashboardContainer.classList.remove('visible', 'hiding');
      if (dataTable) {
        dataTable.clear().destroy();
      }
      userSuffix = "";
      const now = new Date().toISOString().slice(0, 16);
      $('#lastUpdateCall').val(now);
      sessionStorage.setItem('lastUpdateTimestamp', now);
      loginOverlay.style.display = 'flex';
      loginOverlay.classList.add('show');
      document.getElementById('username').value = '';
      document.getElementById('password').value = '';
      hideLoginError();
      modalOverlay.classList.remove('show', 'hiding');
      logoutConfirmModal.style.display = 'none';
      logoutConfirmModal.classList.remove('closing');
      $('#modalOverlay, #confirmModal').hide();
      confirmed = false;
      currentRow = null;
      logoutBtn.style.display = 'none';
      logoutBtn.style.opacity = '';
      console.log("Logged out successfully.");
    }, 600);
  }
  // Insert after the existing function cancelLogout() { ... }
function openReportModal() {
  modalOverlay.classList.add('show');
  $('#reportModal').show();
  setTimeout(() => {
    $('#reportModal').removeClass('closing');
  }, 10);
}
function closeReportModal() {
  modalOverlay.classList.remove('show');
  modalOverlay.classList.add('hiding');
  $('#reportModal').addClass('closing');
  setTimeout(() => {
    modalOverlay.classList.remove('hiding');
    $('#reportModal').hide();
    $('#reportModal').removeClass('closing');
  }, 400);
}
// Insert after the existing logoutBtn.addEventListener('click', initiateLogout);
document.getElementById('reporting-btn').addEventListener('click', openReportModal);
// Insert after the existing function showToast(message, type) { ... }
function generateReport() {
  const startDateStr = $('#startDate').val();
  const endDateStr = $('#endDate').val();
  if (!startDateStr || !endDateStr || new Date(startDateStr) > new Date(endDateStr)) {
    showToast('Invalid date range', 'error');
    return;
  }
  // Treat as full days (midnight to midnight)
  const startDate = new Date(startDateStr + 'T00:00:00').getTime();
  const endDate = new Date(endDateStr + 'T23:59:59.999').getTime();
  const rows = dataTable.rows().nodes();
  const filteredData = [];
  rows.each(function(row) {
    const cells = $(row).find('td');
    const calledDateIso = cells.eq(0).find('.called-date').data('iso');
    const calledDateTime = new Date(calledDateIso).getTime();
    if (calledDateTime >= startDate && calledDateTime <= endDate) {
      filteredData.push({
        username: cells.eq(4).text().trim(),
        calledDate: calledDateIso,
        callStatus: cells.eq(9).find('select').val(),
        feedback: cells.eq(10).find('select').val(),
        socialMediaAdded: cells.eq(14).find('select').val(),
        secondFollowUp: cells.eq(16).find('select').val(),
        thirdFollowUp: cells.eq(17).find('select').val(),
        agentName: cells.eq(18).find('select').val()
      });
    }
  });
  const agents = [...new Set(filteredData.map(row => row.agentName).filter(name => name && name !== 'Select'))].sort();
  const categories = [
    'Total Calls', 'Answered', 'Hang Up', 'No Pick Up', 'Network Issue',
    'Interested', 'Not Interested', 'Social Media Added', '2nd Follow-up', '3rd Follow-up'
  ];
  // Initialize report data with username sets for Total Calls
  const reportData = {};
  agents.forEach(agent => {
    reportData[agent] = { _usernames: new Set() };
  });
  filteredData.forEach(row => {
    const agent = row.agentName;
    if (!agent || agent === 'Select') return;
    // Track unique usernames for Total Calls
    if (row.username) {
      reportData[agent]._usernames.add(row.username);
    }
    if (row.callStatus === 'Answered') reportData[agent]['Answered'] = (reportData[agent]['Answered'] || 0) + 1;
    if (row.callStatus === 'Hang Up') reportData[agent]['Hang Up'] = (reportData[agent]['Hang Up'] || 0) + 1;
    if (row.callStatus === 'No Pick Up') reportData[agent]['No Pick Up'] = (reportData[agent]['No Pick Up'] || 0) + 1;
    if (row.feedback === 'Network Issue') reportData[agent]['Network Issue'] = (reportData[agent]['Network Issue'] || 0) + 1;
    if (row.feedback === 'Interested') reportData[agent]['Interested'] = (reportData[agent]['Interested'] || 0) + 1;
    if (row.feedback === 'Not Interested') reportData[agent]['Not Interested'] = (reportData[agent]['Not Interested'] || 0) + 1;
    if (['WhatsApp', 'Facebook', 'Instagram', 'Telegram'].includes(row.socialMediaAdded)) {
      reportData[agent]['Social Media Added'] = (reportData[agent]['Social Media Added'] || 0) + 1;
    }
    if (row.secondFollowUp === '2nd Attempt') {
      reportData[agent]['2nd Follow-up'] = (reportData[agent]['2nd Follow-up'] || 0) + 1;
    }
    if (row.thirdFollowUp === '3rd Attempt') {
      reportData[agent]['3rd Follow-up'] = (reportData[agent]['3rd Follow-up'] || 0) + 1;
    }
  });
  // Finalize Total Calls counts
  agents.forEach(agent => {
    reportData[agent]['Total Calls'] = reportData[agent]._usernames.size;
    delete reportData[agent]._usernames; // cleanup
  });
  // Build DataTable with auto-fit enabled
  const reportTableInstance = $('#reportTable').DataTable({
    destroy: true,
    paging: false,
    searching: false,
    ordering: false,
    autoWidth: true, // Enable auto column width based on content
    data: categories.map(cat => [cat, ...agents.map(agent => reportData[agent][cat] || 0)]),
    columns: [{ title: 'Category' }, ...agents.map(agent => ({ title: agent }))],
    columnDefs: [
      { targets: '_all', className: 'dt-center' } // Center all, but let width auto-adjust
    ]
  });
  // Force column adjustment after initialization for auto-fit
  reportTableInstance.columns.adjust().draw(false);
  $('#reportTable tbody tr').addClass('animate-row');
}
document.getElementById('generateReportBtn').addEventListener('click', generateReport);
  function cancelLogout() {
    modalOverlay.classList.remove('show');
    modalOverlay.classList.add('hiding');
    logoutConfirmModal.classList.add('closing');
    setTimeout(() => {
      modalOverlay.classList.remove('hiding');
      logoutConfirmModal.style.display = 'none';
      logoutConfirmModal.classList.remove('closing');
    }, 400);
  }
  function confirmLogout() {
    performLogout();
  }
  logoutBtn.addEventListener('click', initiateLogout);
  function rowHasRemarks(tr) {
  const cells = tr.find('td');
  return [
    cells.eq(9).find('select').val(),
    cells.eq(10).find('select').val(),
    cells.eq(12).find('select').val(),
    cells.eq(13).find('select').val(),
    cells.eq(14).find('select').val(),
    cells.eq(16).find('select').val(),
    cells.eq(17).find('select').val(),
    cells.eq(18).find('select').val()
  ].some(val => val && val !== 'Select') ||
    (cells.eq(11).find('textarea').val().trim() !== '');
}
  function initializeDashboard() {
    showInitialLoad();
    google.script.run.withSuccessHandler(data => {
      dropdowns = data;
      if ($.fn.DataTable.isDataTable('#dataTable')) {
        $('#dataTable').DataTable().destroy();
      }
      $.fn.dataTable.ext.search.push(function(settings, data, dataIndex) {
        const row = dataTable.row(dataIndex).node();
        const getVal = (colIdx) => {
          const td = $(row).find('td').eq(colIdx);
          const select = td.find('select');
          if (select.length) return select.val();
          const input = td.find('input');
          if (input.length) return input.val();
          const textarea = td.find('textarea');
          if (textarea.length) return textarea.val();
          return td.text().trim();
        };
        const channelFilterVal = $('#channelFilter').val();
        if (channelFilterVal && getVal(8) !== channelFilterVal) return false;
        const callStatusFilterVal = $('#callStatusFilter').val();
        if (callStatusFilterVal && getVal(9) !== callStatusFilterVal) return false;
        const feedbackFilterVal = $('#feedbackFilter').val();
        if (feedbackFilterVal && getVal(10) !== feedbackFilterVal) return false;
        const preferredGameFilterVal = $('#preferredGameFilter').val();
        if (preferredGameFilterVal && getVal(12) !== preferredGameFilterVal) return false;
        const bonusOfferedFilterVal = $('#bonusOfferedFilter').val();
        if (bonusOfferedFilterVal && getVal(13) !== bonusOfferedFilterVal) return false;
        const socialMediaAddedFilterVal = $('#socialMediaAddedFilter').val();
        if (socialMediaAddedFilterVal && getVal(14) !== socialMediaAddedFilterVal) return false;
        const secondFollowUpFilterVal = $('#secondFollowUpFilter').val();
        if (secondFollowUpFilterVal && getVal(16) !== secondFollowUpFilterVal) return false;
        const thirdFollowUpFilterVal = $('#thirdFollowUpFilter').val();
        if (thirdFollowUpFilterVal && getVal(17) !== thirdFollowUpFilterVal) return false;
        const agentFilterVal = $('#agentFilter').val();
        if (agentFilterVal && getVal(18) !== agentFilterVal) return false;
        return true;
      });
      dataTable = $('#dataTable').DataTable({
  paging: true,
  searching: true,
  ordering: true,
  order: [[3, 'desc']],
  scrollX: true,
  scrollY: 'calc(100vh - 160px)',
  scrollCollapse: true,
  autoWidth: true,
  pageLength: 25,
  lengthMenu: [10, 25, 50, 100, 200, 300, 400, 500, 1000],
  language: { search: '', lengthMenu: '_MENU_' },
  dom: 'rt<"dataTables_wrapper_footer"lip>',
  deferRender: true,
  fixedHeader: {
    header: true,
    footer: true
  },
  columnDefs: [
  { width: 'auto', targets: '_all', className: 'dt-center' },
  { targets: [9, 10, 11, 12, 13, 14, 16, 17, 18], className: 'dt-left' },
  {
    targets: [0],
    defaultContent: '<button class="now-btn" onclick="setCurrentTimestamp(this)">Now</button><span class="called-date" data-iso=""></span>'
  },
  { targets: [1], defaultContent: '' }, // Account Status
  { targets: [2], defaultContent: '<span data-iso=""></span>' },
  { targets: [3], defaultContent: '<span data-iso=""></span>' },
  { targets: [4], defaultContent: '' },
  { targets: [5], defaultContent: '' },
  { targets: [6], defaultContent: '' },
  { targets: [7], defaultContent: '<span data-full-phone="" data-masked="false"></span>' },
  { targets: [8], defaultContent: '' },
  { targets: [9], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [10], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [11], defaultContent: '<textarea></textarea>' },
  { targets: [12], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [13], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [14], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [15], defaultContent: '<button class="call-duration-btn" onclick="toggleCallTimer(this)">Start Call</button><span class="duration-text" style="display:none;"></span>' },
  { targets: [16], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [17], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [18], defaultContent: '<select><option value="Select">Select</option></select>' },
  { targets: [19], defaultContent: '<button onclick="maskPhoneBtn(this)"><span class="spinner"></span><span class="saving-text">Save</span></button>' }
],
  initComplete: function() {
    $('#dt-length-0').on('change', function() {
      const selectedValue = parseInt($(this).val(), 10);
      if (!isNaN(selectedValue)) {
        dataTable.page.len(selectedValue).draw();
      }
    });
    $('#dataTable').on('change input', 'tbody input:not(.now-btn), tbody select, tbody textarea', function() {
      const tr = $(this).closest('tr');
      debounceSave(tr);
      if (rowHasRemarks(tr)) {
        tr.addClass('has-remarks');
      } else {
        tr.removeClass('has-remarks');
      }
    });
    $('#dataTable').on('click', '.call-duration-btn', function() {
      toggleCallTimer(this);
    });
    $('#globalSearch').on('input', function() {
      dataTable.search(this.value).draw();
    });
    $('#callStatusFilter').append(dropdowns.callStatus.map(v => `<option>${v}</option>`).join(''));
    $('#feedbackFilter').append(dropdowns.feedback.map(v => `<option>${v}</option>`).join(''));
    $('#preferredGameFilter').append(dropdowns.preferredGame.map(v => `<option>${v}</option>`).join(''));
    $('#bonusOfferedFilter').append(dropdowns.bonusOffered.map(v => `<option>${v}</option>`).join(''));
    $('#socialMediaAddedFilter').append(dropdowns.socialMediaAdded.map(v => `<option>${v}</option>`).join(''));
    $('#secondFollowUpFilter').append(dropdowns.secondFollowUp.map(v => `<option>${v}</option>`).join(''));
    $('#thirdFollowUpFilter').append(dropdowns.thirdFollowUp.map(v => `<option>${v}</option>`).join(''));
    $('#agentFilter').append(dropdowns.agentName.map(v => `<option>${v}</option>`).join(''));
    $('.filter-select').on('change', function() {
      dataTable.draw();
    });
    fetchDataSmoothly();
    hideInitialLoad();
  }
});
      initDatePicker();
    }).getDropdowns();
  }
  function debounceFetch() {
    clearTimeout(debounceTimer);
    refreshBtn.classList.add('refreshing');
    debounceTimer = setTimeout(() => {
      fetchDataSmoothly(() => {
        refreshBtn.classList.remove('refreshing');
      });
    }, 300);
  }
  function fetchData(callback) {
    const timestamp = sessionStorage.getItem('lastUpdateTimestamp');
    if (!timestamp) {
      console.warn("No lastUpdateTimestamp found in sessionStorage.");
      if (callback) callback();
      return;
    }
    google.script.run
      .withSuccessHandler(newData => {
        updateTableSmoothly(newData || []);
        if (callback) callback();
      })
      .withFailureHandler(error => {
        console.error("Failed to fetch data:", error);
        if (callback) callback();
      })
      .getFilteredData(timestamp, userSuffix);
  }
  function setCurrentTimestamp(button) {
  const tr = $(button).closest('tr');
  const span = tr.find('.called-date');
  const now = new Date().toISOString();
  span.data('iso', now);
  span.text(formatDate(now));
  debounceSave(tr);
}
  function formatDate(isoDate) {
    if (!isoDate) return '';
    const date = new Date(isoDate);
    return date.toLocaleString('en-US', {
      year: 'numeric', month: '2-digit', day: '2-digit',
      hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
    }).replace(',', '');
  }
  // Timer store per row using Map for better management
const timers = new Map();
function toggleCallTimer(button) {
  const $button = $(button);
  const $row = $button.closest('tr');
  const $durationText = $row.find('.duration-text');
  const rowId = $row.find('td:eq(4)').text(); // Use username as a unique identifier

  if (!$button.hasClass('running')) {
    // Start timer
    $button.addClass('running');
    $button.text('Stop Call');
    $durationText.html('').hide(); // Clear previous display
    let startTime = Date.now();
    const interval = setInterval(() => {
      const elapsed = Math.floor((Date.now() - startTime) / 1000); // Seconds
      const elapsedStr = formatTime(elapsed);
      $durationText.data('duration', elapsedStr);
      $durationText.html(elapsedStr).show();
    }, 1000);
    timers.set(rowId, { startTime, interval });
  } else {
    // Stop timer
    $button.removeClass('running');
    $button.text('Start Call');
    const timerObj = timers.get(rowId);
    if (timerObj) {
      clearInterval(timerObj.interval);
      const finalElapsed = Math.floor((Date.now() - timerObj.startTime) / 1000);
      const finalDuration = formatTime(finalElapsed);
      $durationText.data('duration', finalDuration);
      $durationText.html(`Ended Call<br>${finalDuration}`).show();
      timers.delete(rowId);
      debounceSave($row); // Save the duration and other call details
    }
  }
}
function formatTime(seconds) {
  const hours = Math.floor(seconds / 3600);
  const minutes = Math.floor((seconds % 3600) / 60);
  const secs = seconds % 60;
  return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
}
  function debounceSave(tr) {
    clearTimeout(tr.data('timer'));
    tr.data('timer', setTimeout(() => {
      autoSaveRow(tr);
    }, 500));
  }
  function autoSaveRow(tr) {
  const cells = tr.find('td');
  const phoneSpan = cells.eq(7).find('span');
  const $durationText = tr.find('.duration-text');
  const calledDate = cells.eq(0).find('.called-date').data('iso') || '';
  const rowData = {
    calledDate: calledDate,
    accountStatus: cells.eq(1).text(),
    depositTime: cells.eq(2).find('span').data('iso'),
    registrationDate: cells.eq(3).find('span').data('iso'),
    username: cells.eq(4).text(),
    fullName: cells.eq(5).text(),
    email: cells.eq(6).text(),
    phone: phoneSpan.data('fullPhone'),
    channel: cells.eq(8).text(),
    callStatus: cells.eq(9).find('select').val(),
    feedback: cells.eq(10).find('select').val(),
    agentRemark: cells.eq(11).find('textarea').val(),
    preferredGame: cells.eq(12).find('select').val(),
    bonusOffered: cells.eq(13).find('select').val(),
    socialMediaAdded: cells.eq(14).find('select').val(),
    callDuration: $durationText.data('duration') || '', // Capture the displayed duration
    secondFollowUp: cells.eq(16).find('select').val(),
    thirdFollowUp: cells.eq(17).find('select').val(),
    agentName: cells.eq(18).find('select').val(),
    phoneMasked: phoneSpan.data('masked')
  };
  console.log('Saving row:', rowData);
  google.script.run
    .withSuccessHandler(response => {
      showToast('Record Auto-Saved', 'success');
    })
    .withFailureHandler(error => {
      console.error("Failed to auto-save:", error);
      showToast('Failed to auto-save: ' + (error.message || 'Unknown error'), 'error');
    })
    .saveRowToBackend(rowData, userSuffix);
}
  function initDatePicker() {
  let lastUpdate = sessionStorage.getItem('lastUpdateTimestamp');
 
  //  CRITICAL: If there's no valid timestamp in session, set it to a sensible default.
  if (!lastUpdate || lastUpdate === 'null' || lastUpdate === 'undefined') {
    // Option 1: Set it to 24 hours ago to get a reasonable amount of data.
    const yesterday = new Date();
    yesterday.setHours(yesterday.getHours() - 24);
    lastUpdate = yesterday.toISOString().slice(0, 16); // Format: YYYY-MM-DDTHH:mm
   
    // Option 2: Set it to the very beginning of time to get ALL data (use cautiously).
    // lastUpdate = '1970-01-01T00:00';
   
    sessionStorage.setItem('lastUpdateTimestamp', lastUpdate);
  }
 
  // Set the input field value
  $('#lastUpdateCall').val(lastUpdate);
 
  // Update sessionStorage when the user changes the date
  $('#lastUpdateCall').on('change', () => {
    const timestamp = $('#lastUpdateCall').val();
    if (timestamp) {
      sessionStorage.setItem('lastUpdateTimestamp', timestamp);
      // Clear the table and trigger a fresh fetch
      dataTable.clear().draw();
      debounceFetch();
    }
  });
}
  function startPolling() {
  if (!userSuffix) return;
  fetchDataSmoothly();
  setInterval(fetchDataSmoothly, 30000); // Poll every 30 seconds
}
  function fetchDataSmoothly(callback) {
  const timestamp = sessionStorage.getItem('lastUpdateTimestamp');
  console.log('Fetching with timestamp:', timestamp, 'userSuffix:', userSuffix);
  if (!timestamp) {
    console.warn("No lastUpdateTimestamp found in sessionStorage.");
    if (callback) callback();
    return;
  }
  if (!userSuffix) {
    console.warn("No userSuffix found, data fetch aborted.");
    if (callback) callback();
    return;
  }
  google.script.run
    .withSuccessHandler(newData => {
      console.log('Fetched newData:', newData);
      updateTableSmoothly(newData || []);
      if (callback) callback();
    })
    .withFailureHandler(error => {
      console.error("Failed to fetch data:", error);
      updateTableSmoothly([]);
      if (callback) callback();
    })
    .getFilteredData(timestamp, userSuffix);
}
 function updateTableSmoothly(newData) {
  console.log('Received newData:', newData);
  if (newData.length === 0) {
    dataTable.clear().draw();
    return;
  }
  newData = newData.map(row => ({
    calledDate: row.calledDate || '',
    accountStatus: row.accountStatus || '',
    depositTime: row.depositTime || '',
    registrationDate: row.registrationDate || '',
    username: row.username || '',
    fullName: row.fullName || '',
    email: row.email || '',
    phone: row.phone || '',
    channel: row.channel || '',
    callStatus: row.callStatus || '',
    feedback: row.feedback || '',
    agentRemark: row.agentRemark || '',
    preferredGame: row.preferredGame || '',
    bonusOffered: row.bonusOffered || '',
    socialMediaAdded: row.socialMediaAdded || '',
    callDuration: row.callDuration || '',
    secondFollowUp: row.secondFollowUp || '',
    thirdFollowUp: row.thirdFollowUp || '',
    agentName: row.agentName || '',
    phoneMasked: row.phoneMasked || false
  })).filter(row => !['Closed', 'Inactive'].includes(row.accountStatus));
  newData = newData.filter(row => {
    const requiredStatuses = [
      'callStatus', 'feedback', 'preferredGame', 'bonusOffered',
      'socialMediaAdded', 'secondFollowUp', 'thirdFollowUp', 'agentName', 'agentRemark'
    ];
    const hasDepositTime = !!row.depositTime;
    if (!hasDepositTime) return true;
    const hasAnyRemark = requiredStatuses.some(status => {
      if (status === 'agentRemark') return row[status] && row[status].trim() !== '';
      return row[status] && row[status] !== 'Select';
    });
    return hasAnyRemark;
  });
  const seen = new Set();
  newData = newData.filter(row => {
    const key = `${row.username || ''}-${row.phone || ''}-${row.channel || ''}`;
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  });
  const uniqueChannels = [...new Set(newData.map(row => row.channel || '').filter(ch => ch))].sort();
  const currentChannel = $('#channelFilter').val();
  $('#channelFilter').html('<option value="">All Channels</option>' + uniqueChannels.map(ch => `<option${ch === currentChannel ? ' selected' : ''}>${ch}</option>`).join(''));
  const currentRows = dataTable.rows().data().toArray();
  const currentRowKeys = new Set(currentRows.map(row => `${row[4]}-${$(row[7]).data('fullPhone')}-${row[8]}`));
  newData.forEach(newRow => {
    const key = `${newRow.username || ''}-${newRow.phone || ''}-${newRow.channel || ''}`;
    const isPhoneMasked = !!newRow.phoneMasked;
    const displayedPhone = isPhoneMasked ? maskPhone(newRow.phone) : newRow.phone;
    const hasRemarks = [
      'callStatus', 'feedback', 'preferredGame', 'bonusOffered',
      'socialMediaAdded', 'secondFollowUp', 'thirdFollowUp', 'agentName'
    ].some(status => newRow[status] && newRow[status] !== 'Select') ||
      (newRow.agentRemark && newRow.agentRemark.trim() !== '');
    let callDurationHtml = '';
    let durationDisplayStyle = 'display:none;';
    if (newRow.callDuration) {
      callDurationHtml = `Ended Call<br>${newRow.callDuration}`;
      durationDisplayStyle = '';
    }
    const rowData = [
  `<button class="now-btn" onclick="setCurrentTimestamp(this)">Now</button><span class="called-date" data-iso="${newRow.calledDate}">${formatDate(newRow.calledDate)}</span>`,
  newRow.accountStatus,
  `<span data-iso="${newRow.depositTime}">${formatDate(newRow.depositTime)}</span>`,
  `<span data-iso="${newRow.registrationDate}">${formatDate(newRow.registrationDate)}</span>`,
  newRow.username,
  newRow.fullName,
  newRow.email,
  `<span data-full-phone="${newRow.phone}" data-masked="${isPhoneMasked}">${displayedPhone}</span>`,
  newRow.channel,
  `<select><option value="Select"${!newRow.callStatus || newRow.callStatus === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.callStatus.map(v => `<option${v === newRow.callStatus ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<select><option value="Select"${!newRow.feedback || newRow.feedback === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.feedback.map(v => `<option${v === newRow.feedback ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<textarea>${newRow.agentRemark}</textarea>`,
  `<select><option value="Select"${!newRow.preferredGame || newRow.preferredGame === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.preferredGame.map(v => `<option${v === newRow.preferredGame ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<select><option value="Select"${!newRow.bonusOffered || newRow.bonusOffered === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.bonusOffered.map(v => `<option${v === newRow.bonusOffered ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<select><option value="Select"${!newRow.socialMediaAdded || newRow.socialMediaAdded === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.socialMediaAdded.map(v => `<option${v === newRow.socialMediaAdded ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<button class="call-duration-btn" onclick="toggleCallTimer(this)">Start Call</button><span class="duration-text" style="${durationDisplayStyle}" data-duration="${newRow.callDuration || ''}">${callDurationHtml}</span>`,
  `<select><option value="Select"${!newRow.secondFollowUp || newRow.secondFollowUp === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.secondFollowUp.map(v => `<option${v === newRow.secondFollowUp ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<select><option value="Select"${!newRow.thirdFollowUp || newRow.thirdFollowUp === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.thirdFollowUp.map(v => `<option${v === newRow.thirdFollowUp ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<select><option value="Select"${!newRow.agentName || newRow.agentName === 'Select' ? ' selected' : ''}>Select</option>${dropdowns.agentName.map(v => `<option${v === newRow.agentName ? ' selected' : ''}>${v}</option>`).join('')}</select>`,
  `<button onclick="maskPhoneBtn(this)"><span class="spinner"></span><span class="saving-text">Save</span></button>`
];
    if (!currentRowKeys.has(key)) {
      const rowNode = dataTable.row.add(rowData).node();
      $(rowNode).addClass('new-row');
      if (hasRemarks) {
        $(rowNode).addClass('has-remarks');
      }
    } else {
      const rowIndex = currentRows.findIndex(row => `${row[4]}-${$(row[7]).data('fullPhone')}-${row[8]}` === key);
      const rowNode = dataTable.row(rowIndex).node();
      dataTable.row(rowIndex).data(rowData);
      if (hasRemarks) {
        $(rowNode).addClass('has-remarks');
      } else {
        $(rowNode).removeClass('has-remarks');
      }
    }
  });
  currentRows.forEach((row, index) => {
    const key = `${row[4]}-${$(row[7]).data('fullPhone')}-${row[8]}`;
    if (!newData.some(newRow => `${newRow.username || ''}-${newRow.phone || ''}-${newRow.channel || ''}` === key)) {
      dataTable.row(index).remove();
    }
  });
  dataTable.draw(false);
}
  if (userSuffix) {
    startPolling();
  }
  function maskPhoneBtn(button) {
    const btnElement = $(button);
    currentRow = btnElement.closest('tr');
    if (!confirmed) {
      modalOverlay.classList.add('show');
      $('#confirmModal').show();
      return;
    }
    btnElement.addClass('saving');
    const cells = currentRow.find('td');
    const callStatus = cells.eq(9).find('select').val();
    const feedback = cells.eq(10).find('select').val();
    if (callStatus === 'Select' || feedback === 'Select') {
      showToast('Select Call Status and Feedback to mask phone', 'error');
      btnElement.removeClass('saving');
      confirmed = false;
      return;
    }
    const phoneSpan = cells.eq(7).find('span');
    const rowData = {
  calledDate: cells.eq(0).find('.called-date').data('iso') || '',
  accountStatus: cells.eq(1).text(),
  depositTime: cells.eq(2).find('span').data('iso'),
  registrationDate: cells.eq(3).find('span').data('iso'),
  username: cells.eq(4).text(),
  fullName: cells.eq(5).text(),
  email: cells.eq(6).text(),
  phone: phoneSpan.data('fullPhone'),
  channel: cells.eq(8).text(),
  callStatus: callStatus,
  feedback: feedback,
  agentRemark: cells.eq(11).find('textarea').val(),
  preferredGame: cells.eq(12).find('select').val(),
  bonusOffered: cells.eq(13).find('select').val(),
  socialMediaAdded: cells.eq(14).find('select').val(),
  callDuration: cells.eq(15).find('.duration-text').data('duration') || '',
  secondFollowUp: cells.eq(16).find('select').val(),
  thirdFollowUp: cells.eq(17).find('select').val(),
  agentName: cells.eq(18).find('select').val(),
  phoneMasked: true
};
    google.script.run
      .withSuccessHandler(response => {
        phoneSpan.text(response.maskedPhone);
        phoneSpan.data('masked', true);
        showToast('Phone Masked and Saved', 'success');
        btnElement.removeClass('saving');
        confirmed = false;
      })
      .withFailureHandler(error => {
        showToast('Failed to mask phone: ' + (error.message || 'Unknown error'), 'error');
        btnElement.removeClass('saving');
        confirmed = false;
      })
      .saveRowToBackend(rowData, userSuffix);
  }
  function confirmMask() {
    confirmed = true;
    modalOverlay.classList.remove('show');
    $('#confirmModal').hide();
    if (currentRow) {
      maskPhoneBtn(currentRow.find('button')[0]);
    }
  }
  function closeModal() {
    confirmed = false;
    modalOverlay.classList.remove('show');
    $('#confirmModal').hide();
    if (currentRow) {
      currentRow.find('button').removeClass('saving');
    }
  }
  function showToast(message, type) {
    Toastify({
      text: message,
      duration: 3000,
      style: {
        background: type === 'success' ? 'linear-gradient(135deg, #28a745, #2ecc71)' : 'linear-gradient(135deg, #dc3545, #e63946)',
        borderRadius: '8px',
        boxShadow: '0 4px 15px rgb(0, 0, 0, 0.2)',
        fontSize: '14px',
        padding: '12px 20px',
        fontWeight: 600
      }
    }).showToast();
  }
  refreshBtn.addEventListener('click', debounceFetch);
</script>